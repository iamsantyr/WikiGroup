<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{_fragments/layout :: layout(~{::section})}">
<head>
  <meta charset="UTF-8">
  <title th:text="${pageTitle} ?: 'Mensajes recibidos'">Mensajes recibidos</title>
</head>
<body>
<section>
  <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap;">
    <h2 style="margin:0;">Mensajes recibidos</h2>
    <div style="display:flex; gap:.5rem;">
      <a th:href="@{/mensajes/export.csv}" class="btn-secondary" style="text-decoration:none; display:inline-block; padding:.5rem .75rem; border:1px solid #d1d5db; border-radius:.45rem;">
        Exportar CSV
      </a>
      <a th:href="@{/contacto}" class="btn" style="text-decoration:none; display:inline-block; padding:.5rem .75rem; background:#4f46e5; color:#fff; border-radius:.45rem;">
        Nuevo mensaje
      </a>
    </div>
  </div>

  <div th:if="${okMsg}" class="ok" th:text="${okMsg}" style="color:#0a7b28; margin:.5rem 0;"></div>
  <div th:if="${errorMsg}" class="error" th:text="${errorMsg}" style="color:#c00; margin:.5rem 0;"></div>

  <div th:if="${#lists.isEmpty(items)}" style="margin-top:1rem;">
    <p>No hay mensajes registrados aún.</p>
    <p><a th:href="@{/contacto}">Ir al formulario de contacto →</a></p>
  </div>

  <div th:unless="${#lists.isEmpty(items)}" style="overflow-x:auto; margin-top:1rem;">
    <table>
      <thead>
      <tr>
        <th>ID</th>
        <th>Fecha</th>
        <th>Nombres</th>
        <th>Apellidos</th>
        <th>Correo</th>
        <th>Semestre</th>
        <th>Descripción</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="c : ${items}">
        <td th:text="${c.id}">1</td>
        <td th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">2025-08-14 14:30</td>
        <td th:text="${c.nombres}">NOMBRES</td>
        <td th:text="${c.apellidos}">APELLIDOS</td>
        <td th:text="${c.correo}">CORREO</td>
        <td th:text="${c.semestre}">0</td>
        <td th:text="${c.descripcion}">TEXTO…</td>
        <td>
          <form th:action="@{|/mensajes/${c.id}/eliminar|}" method="post"
                onsubmit="return confirm('¿Eliminar el mensaje #'+this.dataset.id+'?');"
                th:attr="data-id=${c.id}">
            <button type="submit">Eliminar</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</section>
</body>
</html>
